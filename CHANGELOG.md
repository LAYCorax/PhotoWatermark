# PhotoWatermark 更新日志

## [未发布] - 2025-10-04

### 新增功能

#### 模板系统 (迭代四-第一项)
- ✨ 实现完整的水印模板管理系统
  - 模板创建、保存、加载、删除功能
  - 模板导入/导出（JSON格式）
  - 3个默认模板（简单文字、描边文字、阴影文字）
  - 模板管理对话框UI，支持搜索过滤
  - 模板重名检查，提供覆盖确认对话框
  - 应用模板后UI自动同步更新所有控件值

#### 字体渲染优化
- ✨ 创建高级文本渲染器 (AdvancedTextRenderer)
  - 统一预览和导出的字体渲染逻辑
  - 完整支持文字描边效果
  - 完整支持文字阴影效果
  - TrueType字体精确渲染

#### 图片导出功能
- ✨ 实现批量导出引擎 (BatchExportEngine)
  - 支持JPEG和PNG格式导出
  - 可配置图片质量和压缩率
  - 源目录覆盖检查和警告
  - 精确列出会被覆盖的文件列表
  - 导出进度对话框显示实时进度

#### 图片缩放功能
- ✨ 导出时支持图片尺寸缩放
  - 百分比缩放模式 (25%, 50%, 75%, 原始)
  - 固定尺寸模式 (自定义宽度x高度)
  - 保持宽高比选项
  - 先加水印再缩放，确保水印清晰度

#### PNG透明度支持
- ✨ 完整支持PNG透明通道
  - RGBA模式的完整保持
  - 水印渲染时保持透明度
  - 导出时根据格式自动处理颜色模式

### 问题修复

#### 字体渲染
- 🐛 修复导出图片时描边效果不显示的问题
- 🐛 修复FontManager字体回退机制失败问题
- 🐛 改进字体查找逻辑，添加多级回退机制

#### 导出功能
- 🐛 修复导出设置对话框combobox悬停触发错误
- 🐛 修复browse方法的参数传递问题
- 🐛 修复PNG透明通道丢失，导出后背景变黑的问题

#### 模板系统
- 🐛 修复模板对话框按钮点击TypeError
  - 所有槽方法添加checked参数
- 🐛 修复应用模板后UI控件不更新的问题
  - load_config调用所有子控件的update_ui_from_config()
  - 同步更新文本、字体、颜色、透明度等48个UI控件

#### 水印处理
- 🐛 修复大尺寸图片水印处理导致程序崩溃
  - 实现内存保守模式
  - 局部overlay替代全图尺寸overlay
- 🐛 修复RGBA模式图片保存为JPEG错误
  - 自动转换颜色模式
  - JPEG格式使用白色背景合成

### 代码改进

#### 架构优化
- ♻️ 创建核心模块 core/template_manager.py
- ♻️ 创建对话框 ui/dialogs/template_dialog.py
- ♻️ 优化 WatermarkConfigWidget.load_config() 方法
- ♻️ 统一高级文本效果渲染逻辑

#### 代码质量
- 📝 添加完整的日志记录
- 📝 改进异常处理和错误提示
- 📝 添加类型提示和文档字符串
- 🧪 添加模板系统单元测试

### 文档更新

#### 新增文档
- 📚 TEMPLATE_GUIDE.md - 模板系统用户指南
- 📚 TEMPLATE_IMPLEMENTATION.md - 模板系统实现文档
- 📚 BUGFIX_TEMPLATE_DIALOG.md - 模板对话框修复文档
- 📚 ENHANCEMENT_TEMPLATE_UI_SYNC.md - UI同步更新增强文档
- 📚 ENHANCEMENT_TEMPLATE_DUPLICATE_CHECK.md - 重名检查功能文档

#### 更新文档
- 📚 STATUS.md - 添加迭代二、三、四完成情况
- 📚 PROJECT_SUMMARY.md - 更新项目概述
- 📚 README.md - 更新功能列表

### 测试

#### 新增测试
- 🧪 tests/test_template_system.py - 模板系统完整测试
- 🧪 tests/test_rgba_fix.py - RGBA模式修复测试
- 🧪 tests/test_rgba_simple.py - RGBA简单测试

#### 测试结果
- ✅ 所有核心功能测试通过
- ✅ 模板系统单元测试100%通过
- ✅ 大图片处理测试通过
- ✅ RGBA模式测试通过

---

## [迭代一] - 2025-09-XX

### 新增功能
- ✨ 实现主窗口框架和布局
- ✨ 文件导入功能（拖拽、选择器、文件夹）
- ✨ 图片列表管理（缩略图、信息显示、批量操作）
- ✨ 基础文本水印功能
- ✨ 实时预览功能
- ✨ 数据模型和配置系统

### 问题修复
- 🐛 修复QGraphicsScene类型错误
- 🐛 修复ImageListModel删除逻辑错误
- 🐛 修复字体加载问题
- 🐛 修复线程管理问题
- 🐛 修复PIL textbbox兼容性
- 🐛 修复预览图像色差问题
- 🐛 修复大规模文件处理异常退出

---

## 图例说明

- ✨ 新增功能 (feat)
- 🐛 问题修复 (fix)
- ♻️ 代码重构 (refactor)
- 📝 文档更新 (docs)
- 🧪 测试相关 (test)
- ⚡️ 性能优化 (perf)
- 🎨 代码格式 (style)
